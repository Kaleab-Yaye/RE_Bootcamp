
# The Consts command

now when you want to put hard coded values into a register in smali it is a bit verbose. so you should know your aim is to understand smali and try to correspond it to the kotlin or the java it was written on. so you should when you see a code that is what the programmer wrote, we won't be putting values into smali, now we will just see how to read it.

now you use const this way

```java
int number = 1
```

if this was the java code of the app here is what would be the smali that corresponds to it. just know that they have to be put in hex

```
const/4 <dest_register>, <value>
```

```smali
const/4 v0, 0x1  // telling the vm to put the value of 1 into register v0
or
const/16 v0, 89 // tell the vm to put the larger value 89 into register v0
```

you should know const/4 is used for small numbers ok

## what about string values

when an app was built and when the entire project was being built into a dalvik .dex file the compiler does a lot of optimization one of them creating a string table from where the vm can look up for specific strings. this is because registers can hold objects but can only hold their reference. so when a register is assigned to a specific string or object then the vm will look up this table to access the value for that string.

example lets say this was part of the java code that is going to be built

```java
String name = "kaleab";
```

now during build time the string kaleab will be put into an optimized table of strings. now in smali

```smali
const-string v0, "kaleab"
```

now when this field is loaded into the memory the v0 will hold the reference for the string "kaleab" on the table. the vm will look it up and find our string

but what if there is no string "kaleab" on the table. then the vm would create the object "kaleab" on the string dynamic pool

there are other const commands like const-class which you don't use as usual so if you need to you can add them here

# Logic control in smali

now the logic control in smali is a bit weird and they use the old goto and jump commands to navigate along blocks of code. but first

## labels

in smali labels are the tags of a block. if a block code has labels above it it can be part of the logic flows and the vm can jump from it and to it to do some logic control

```smali
:some_label
.....block code identified by that label.....
```

## the unconditional jump

now look at this block of smali code

```smali
# this is all inside a method ok
iput v0, p1, L/packages/MyClass->number:I  # putting some integer value in v0
iput v1, p2, L/packages/MySecondClass->number:I  # putting some integer value in v1

....some block code here....  # this will be executed
goto :skip_this
.... this block code will be skipped....
......this block code will be skipped....
:skip_this
.... this code will not be skipped it will be executed.....
```

now this is useful in some cases but why write a code that would be skipped no matter what so that is why we see the

## the conditional jump

the conditional jump follows the syntax

```
if<test> <compare1>, <compare2> :<label to jump to if the test was true>
```

you should know order matters. here are the most useful tests with their correspondence in java

![image](https://github.com/user-attachments/assets/4618a62b-7000-4be8-972a-b75e35e7bfd6)

now there is also another useful test against zero. we do a lot of comparison against zero and they are useful

![image](https://github.com/user-attachments/assets/cbff227a-0973-4625-90ae-1ac312ead4af)

## the if else logic

now what we will try to do is try to convert this simple java code into a smali code

```java
# the v0 is int a and the v1 is int b
int a = myClass.number
int b = mySecondClass.number

if (a >= b)
System.out.println("a is bigger number");
else {
    System.out.println("b is bigger number");
}

System.out.println("comparison is over");
```

now the code is simple and does not do much but it is easy to write in smali while solidifying our understanding in smali control flow

this is what it would look like in smali. now under the if test we want what the immediate code block was under the if block on the java and to pass to that part of the code our execution should fall through the if statement. so to do this the comparison in smali looks the opposite of our java block but it does the same

```smali
iput v0, p1, L/packages/MyClass->number:I  # putting some integer value in v0
iput v1, p2, L/packages/MySecondClass->number:I  # putting some integer value in v1

if-lt v0, v1 :else_block
....code to print "v0 is bigger number"....
goto :if_final  # if this code is executed the else block will be ignored completely

:else_block
....code to print "v1 is bigger number"....

:if_final  # this is the last code we need to execute despite the outcome
....code to print "comparison is over"
```

understanding this is crucial for following conditional flow

# exercise

```smali
.locals 2

# Assume v0 holds the boolean result (1 for true, 0 for false).

const-string v1, "Access Denied"

# Line 1:
if-nez v0, :access_granted

# Line 2:
goto :end

# Line 3:
:access_granted

# Line 4:
const-string v1, "Access Granted"

# Line 5:
:end

# The code continues from here...
# The final result message is now in register v1.
```

now based on that answer the following

* trace the execution flow assuming the password was incorrect, so the initial value in v0 is 0 (false). what is the final string value in register v1 when execution reaches the :end label?
* now, trace the execution flow assuming the password was correct, so the initial value in v0 is 1 (true). what is the final string value in register v1 at the end?
* what common high-level programming structure does this pattern of if and goto create?

## answer

so the default state of the v1 is access denied.

now if v0 is in zero state that would mean the if check would fail and then we would fall through the if code which leads us to the end of the code. which would probably say try again (wow aha moment, this could be used as a loop with many goto commands i will see that later)

now if v0 is in one state that would mean the if check would send us to the implicit else statement that re-assigns v1 to the reference value to access granted.

then this would go to the end it could lead us to other parts of the code using goto based on what the state of v1 is.

and i suspect this might resemble a switch statement or it is just normal if else
